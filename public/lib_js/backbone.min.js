(function(){var z=this;var x=z.Backbone;var c=[];var y=c.push;var E=c.slice;var G=c.splice;var e;if(typeof exports!=="undefined"){e=exports}else{e=z.Backbone={}}e.VERSION="1.1.0";var a=z._;if(!a&&(typeof require!=="undefined")){a=require("underscore")}e.$=z.jQuery||z.Zepto||z.ender||z.$;e.noConflict=function(){z.Backbone=x;return this};e.emulateHTTP=false;e.emulateJSON=false;var i=e.Events={on:function(Q,N,O){if(!j(this,"on",Q,[N,O])||!N){return this}this._events||(this._events={});var P=this._events[Q]||(this._events[Q]=[]);P.push({callback:N,context:O,ctx:O||this});return this},once:function(P,N,O){if(!j(this,"once",P,[N,O])||!N){return this}var R=this;var Q=a.once(function(){R.off(P,Q);N.apply(this,arguments)});Q._callback=N;return this.on(P,Q,O)},off:function(V,N,O){var X,P,Q,W,R,U,S,T;if(!this._events||!j(this,"off",V,[N,O])){return this}if(!V&&!N&&!O){this._events={};return this}W=V?[V]:a.keys(this._events);for(R=0,U=W.length;R<U;R++){V=W[R];if(Q=this._events[V]){this._events[V]=X=[];if(N||O){for(S=0,T=Q.length;S<T;S++){P=Q[S];if((N&&N!==P.callback&&N!==P.callback._callback)||(O&&O!==P.context)){X.push(P)}}}if(!X.length){delete this._events[V]}}}return this},trigger:function(Q){if(!this._events){return this}var O=E.call(arguments,1);if(!j(this,"trigger",Q,O)){return this}var P=this._events[Q];var N=this._events.all;if(P){I(P,O)}if(N){I(N,arguments)}return this},stopListening:function(R,Q,N){var P=this._listeningTo;if(!P){return this}var S=!Q&&!N;if(!N&&typeof Q==="object"){N=this}if(R){(P={})[R._listenId]=R}for(var O in P){R=P[O];R.off(Q,N,this);if(S||a.isEmpty(R._events)){delete this._listeningTo[O]}}return this}};var k=/\s+/;var j=function(T,N,R,U){if(!R){return true}if(typeof R==="object"){for(var P in R){T[N].apply(T,[P,R[P]].concat(U))}return false}if(k.test(R)){var S=R.split(k);for(var O=0,Q=S.length;O<Q;O++){T[N].apply(T,[S[O]].concat(U))}return false}return true};var I=function(S,Q){var R,T=-1,U=S.length,N=Q[0],O=Q[1],P=Q[2];switch(Q.length){case 0:while(++T<U){(R=S[T]).callback.call(R.ctx)}return;case 1:while(++T<U){(R=S[T]).callback.call(R.ctx,N)}return;case 2:while(++T<U){(R=S[T]).callback.call(R.ctx,N,O)}return;case 3:while(++T<U){(R=S[T]).callback.call(R.ctx,N,O,P)}return;default:while(++T<U){(R=S[T]).callback.apply(R.ctx,Q)}}};var o={listenTo:"on",listenToOnce:"once"};a.each(o,function(N,O){i[O]=function(T,S,P){var R=this._listeningTo||(this._listeningTo={});var Q=T._listenId||(T._listenId=a.uniqueId("l"));R[Q]=T;if(!P&&typeof S==="object"){P=this}T[N](S,P,this);return this}});i.bind=i.on;i.unbind=i.off;a.extend(e,i);var r=e.Model=function(N,P){var O=N||{};P||(P={});this.cid=a.uniqueId("c");this.attributes={};if(P.collection){this.collection=P.collection}if(P.parse){O=this.parse(O,P)||{}}O=a.defaults({},O,a.result(this,"defaults"));this.set(O,P);this.changed={};this.initialize.apply(this,arguments)};a.extend(r.prototype,i,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(N){return a.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(N){return this.attributes[N]},escape:function(N){return a.escape(this.get(N))},has:function(N){return this.get(N)!=null},set:function(T,Z,V){var N,O,Y,P,X,Q,W,R;if(T==null){return this}if(typeof T==="object"){O=T;V=Z}else{(O={})[T]=Z}V||(V={});if(!this._validate(O,V)){return false}Y=V.unset;X=V.silent;P=[];Q=this._changing;this._changing=true;if(!Q){this._previousAttributes=a.clone(this.attributes);this.changed={}}R=this.attributes,W=this._previousAttributes;if(this.idAttribute in O){this.id=O[this.idAttribute]}for(N in O){Z=O[N];if(!a.isEqual(R[N],Z)){P.push(N)}if(!a.isEqual(W[N],Z)){this.changed[N]=Z}else{delete this.changed[N]}Y?delete R[N]:R[N]=Z}if(!X){if(P.length){this._pending=true}for(var S=0,U=P.length;S<U;S++){this.trigger("change:"+P[S],this,R[P[S]],V)}}if(Q){return this}if(!X){while(this._pending){this._pending=false;this.trigger("change",this,V)}}this._pending=false;this._changing=false;return this},unset:function(N,O){return this.set(N,void 0,a.extend({},O,{unset:true}))},clear:function(P){var N={};for(var O in this.attributes){N[O]=void 0}return this.set(N,a.extend({},P,{unset:true}))},hasChanged:function(N){if(N==null){return !a.isEmpty(this.changed)}return a.has(this.changed,N)},changedAttributes:function(P){if(!P){return this.hasChanged()?a.clone(this.changed):false}var R,O=false;var Q=this._changing?this._previousAttributes:this.attributes;for(var N in P){if(a.isEqual(Q[N],(R=P[N]))){continue}(O||(O={}))[N]=R}return O},previous:function(N){if(N==null||!this._previousAttributes){return null}return this._previousAttributes[N]},previousAttributes:function(){return a.clone(this._previousAttributes)},fetch:function(O){O=O?a.clone(O):{};if(O.parse===void 0){O.parse=true}var N=this;var P=O.success;O.success=function(Q){if(!N.set(N.parse(Q,O),O)){return false}if(P){P(N,Q,O)}N.trigger("sync",N,Q,O)};M(this,O);return this.sync("read",this,O)},save:function(P,U,S){var O,Q,V,N=this.attributes;if(P==null||typeof P==="object"){O=P;S=U}else{(O={})[P]=U}S=a.extend({validate:true},S);if(O&&!S.wait){if(!this.set(O,S)){return false}}else{if(!this._validate(O,S)){return false}}if(O&&S.wait){this.attributes=a.extend({},N,O)}if(S.parse===void 0){S.parse=true}var R=this;var T=S.success;S.success=function(W){R.attributes=N;var X=R.parse(W,S);if(S.wait){X=a.extend(O||{},X)}if(a.isObject(X)&&!R.set(X,S)){return false}if(T){T(R,W,S)}R.trigger("sync",R,W,S)};M(this,S);Q=this.isNew()?"create":(S.patch?"patch":"update");if(Q==="patch"){S.attrs=O}V=this.sync(Q,this,S);if(O&&S.wait){this.attributes=N}return V},destroy:function(P){P=P?a.clone(P):{};var O=this;var Q=P.success;var N=function(){O.trigger("destroy",O,O.collection,P)};P.success=function(S){if(P.wait||O.isNew()){N()}if(Q){Q(O,S,P)}if(!O.isNew()){O.trigger("sync",O,S,P)}};if(this.isNew()){P.success();return false}M(this,P);var R=this.sync("delete",this,P);if(!P.wait){N()}return R},url:function(){var N=a.result(this,"urlRoot")||a.result(this.collection,"url")||J();if(this.isNew()){return N}return N+(N.charAt(N.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(O,N){return O},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(N){return this._validate({},a.extend(N||{},{validate:true}))},_validate:function(N,P){if(!P.validate||!this.validate){return true}N=a.extend({},this.attributes,N);var O=this.validationError=this.validate(N,P)||null;if(!O){return true}this.trigger("invalid",this,O,a.extend(P,{validationError:O}));return false}});var s=["keys","values","pairs","invert","pick","omit"];a.each(s,function(N){r.prototype[N]=function(){var O=E.call(arguments);O.unshift(this.attributes);return a[N].apply(a,O)}});var f=e.Collection=function(N,O){O||(O={});if(O.model){this.model=O.model}if(O.comparator!==void 0){this.comparator=O.comparator}this._reset();this.initialize.apply(this,arguments);if(N){this.reset(N,a.extend({silent:true},O))}};var D={add:true,remove:true,merge:true};var b={add:true,remove:false};a.extend(f.prototype,i,{model:r,initialize:function(){},toJSON:function(N){return this.map(function(O){return O.toJSON(N)})},sync:function(){return e.sync.apply(this,arguments)},add:function(N,O){return this.set(N,a.extend({merge:false},O,b))},remove:function(R,S){var T=!a.isArray(R);R=T?[R]:a.clone(R);S||(S={});var N,P,O,Q;for(N=0,P=R.length;N<P;N++){Q=R[N]=this.get(R[N]);if(!Q){continue}delete this._byId[Q.id];delete this._byId[Q.cid];O=this.indexOf(Q);this.models.splice(O,1);this.length--;if(!S.silent){S.index=O;Q.trigger("remove",Q,this,S)}this._removeReference(Q)}return T?R[0]:R},set:function(X,Y){Y=a.defaults({},Y,D);if(Y.parse){X=this.parse(X,Y)}var ac=!a.isArray(X);X=ac?(X?[X]:[]):a.clone(X);var R,T,S,V,P,Q,ad;var O=Y.at;var ag=this.model;var ae=this.comparator&&(O==null)&&Y.sort!==false;var af=a.isString(this.comparator)?this.comparator:null;var ah=[],ai=[],W={};var N=Y.add,U=Y.merge,ab=Y.remove;var Z=!ae&&N&&ab?[]:false;for(R=0,T=X.length;R<T;R++){P=X[R];if(P instanceof r){S=V=P}else{S=P[ag.prototype.idAttribute]}if(Q=this.get(S)){if(ab){W[Q.cid]=true}if(U){P=P===V?V.attributes:P;if(Y.parse){P=Q.parse(P,Y)}Q.set(P,Y);if(ae&&!ad&&Q.hasChanged(af)){ad=true}}X[R]=Q}else{if(N){V=X[R]=this._prepareModel(P,Y);if(!V){continue}ah.push(V);V.on("all",this._onModelEvent,this);this._byId[V.cid]=V;if(V.id!=null){this._byId[V.id]=V}}}if(Z){Z.push(Q||V)}}if(ab){for(R=0,T=this.length;R<T;++R){if(!W[(V=this.models[R]).cid]){ai.push(V)}}if(ai.length){this.remove(ai,Y)}}if(ah.length||(Z&&Z.length)){if(ae){ad=true}this.length+=ah.length;if(O!=null){for(R=0,T=ah.length;R<T;R++){this.models.splice(O+R,0,ah[R])}}else{if(Z){this.models.length=0}var aa=Z||ah;for(R=0,T=aa.length;R<T;R++){this.models.push(aa[R])}}}if(ad){this.sort({silent:true})}if(!Y.silent){for(R=0,T=ah.length;R<T;R++){(V=ah[R]).trigger("add",V,this,Y)}if(ad||(Z&&Z.length)){this.trigger("sort",this,Y)}}return ac?X[0]:X},reset:function(P,Q){Q||(Q={});for(var N=0,O=this.models.length;N<O;N++){this._removeReference(this.models[N])}Q.previousModels=this.models;this._reset();P=this.add(P,a.extend({silent:true},Q));if(!Q.silent){this.trigger("reset",this,Q)}return P},push:function(N,O){return this.add(N,a.extend({at:this.length},O))},pop:function(O){var N=this.at(this.length-1);this.remove(N,O);return N},unshift:function(N,O){return this.add(N,a.extend({at:0},O))},shift:function(O){var N=this.at(0);this.remove(N,O);return N},slice:function(){return E.apply(this.models,arguments)},get:function(N){if(N==null){return void 0}return this._byId[N.id]||this._byId[N.cid]||this._byId[N]},at:function(N){return this.models[N]},where:function(N,O){if(a.isEmpty(N)){return O?void 0:[]}return this[O?"find":"filter"](function(Q){for(var P in N){if(N[P]!==Q.get(P)){return false}}return true})},findWhere:function(N){return this.where(N,true)},sort:function(N){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}N||(N={});if(a.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(a.bind(this.comparator,this))}if(!N.silent){this.trigger("sort",this,N)}return this},pluck:function(N){return a.invoke(this.models,"get",N)},fetch:function(O){O=O?a.clone(O):{};if(O.parse===void 0){O.parse=true}var P=O.success;var N=this;O.success=function(R){var Q=O.reset?"reset":"set";N[Q](R,O);if(P){P(N,R,O)}N.trigger("sync",N,R,O)};M(this,O);return this.sync("read",this,O)},create:function(O,P){P=P?a.clone(P):{};if(!(O=this._prepareModel(O,P))){return false}if(!P.wait){this.add(O,P)}var N=this;var Q=P.success;P.success=function(R,T,S){if(S.wait){N.add(R,S)}if(Q){Q(R,T,S)}};O.save(null,P);return O},parse:function(O,N){return O},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(N,P){if(N instanceof r){if(!N.collection){N.collection=this}return N}P=P?a.clone(P):{};P.collection=this;var O=new this.model(N,P);if(!O.validationError){return O}this.trigger("invalid",this,O.validationError,P);return false},_removeReference:function(N){if(this===N.collection){delete N.collection}N.off("all",this._onModelEvent,this)},_onModelEvent:function(O,P,N,Q){if((O==="add"||O==="remove")&&N!==this){return}if(O==="destroy"){this.remove(P,Q)}if(P&&O==="change:"+P.idAttribute){delete this._byId[P.previous(P.idAttribute)];if(P.id!=null){this._byId[P.id]=P}}this.trigger.apply(this,arguments)}});var q=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];a.each(q,function(N){f.prototype[N]=function(){var O=E.call(arguments);O.unshift(this.models);return a[N].apply(a,O)}});var d=["groupBy","countBy","sortBy"];a.each(d,function(N){f.prototype[N]=function(Q,O){var P=a.isFunction(Q)?Q:function(R){return R.get(Q)};return a[N](this.models,P,O)}});var K=e.View=function(N){this.cid=a.uniqueId("view");N||(N={});a.extend(this,a.pick(N,L));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var g=/^(\S+)\s*(.*)$/;var L=["model","collection","el","id","attributes","className","tagName","events"];a.extend(K.prototype,i,{tagName:"div",$:function(N){return this.$el.find(N)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(O,N){if(this.$el){this.undelegateEvents()}this.$el=O instanceof e.$?O:e.$(O);this.el=this.$el[0];if(N!==false){this.delegateEvents()}return this},delegateEvents:function(O){if(!(O||(O=a.result(this,"events")))){return this}this.undelegateEvents();for(var P in O){var R=O[P];if(!a.isFunction(R)){R=this[O[P]]}if(!R){continue}var Q=P.match(g);var N=Q[1],S=Q[2];R=a.bind(R,this);N+=".delegateEvents"+this.cid;if(S===""){this.$el.on(N,R)}else{this.$el.on(N,S,R)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_ensureElement:function(){if(!this.el){var O=a.extend({},a.result(this,"attributes"));if(this.id){O.id=a.result(this,"id")}if(this.className){O["class"]=a.result(this,"className")}var N=e.$("<"+a.result(this,"tagName")+">").attr(O);this.setElement(N,false)}else{this.setElement(a.result(this,"el"),false)}}});e.sync=function(O,P,Q){var S=p[O];a.defaults(Q||(Q={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var R={type:S,dataType:"json"};if(!Q.url){R.url=a.result(P,"url")||J()}if(Q.data==null&&P&&(O==="create"||O==="update"||O==="patch")){R.contentType="application/json";R.data=JSON.stringify(Q.attrs||P.toJSON(Q))}if(Q.emulateJSON){R.contentType="application/x-www-form-urlencoded";R.data=R.data?{model:R.data}:{}}if(Q.emulateHTTP&&(S==="PUT"||S==="DELETE"||S==="PATCH")){R.type="POST";if(Q.emulateJSON){R.data._method=S}var N=Q.beforeSend;Q.beforeSend=function(U){U.setRequestHeader("X-HTTP-Method-Override",S);if(N){return N.apply(this,arguments)}}}if(R.type!=="GET"&&!Q.emulateJSON){R.processData=false}if(R.type==="PATCH"&&u){R.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var T=Q.xhr=e.ajax(a.extend(R,Q));P.trigger("request",P,T,Q);return T};var u=typeof window!=="undefined"&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var p={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var B=e.Router=function(N){N||(N={});if(N.routes){this.routes=N.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var v=/\((.*?)\)/g;var t=/(\(\?)?:\w+/g;var F=/\*\w+/g;var h=/[\-{}\[\]+?.,\\\^$|#\s]/g;a.extend(B.prototype,i,{initialize:function(){},route:function(P,O,N){if(!a.isRegExp(P)){P=this._routeToRegExp(P)}if(a.isFunction(O)){N=O;O=""}if(!N){N=this[O]}var Q=this;e.history.route(P,function(S){var R=Q._extractParameters(P,S);N&&N.apply(Q,R);Q.trigger.apply(Q,["route:"+O].concat(R));Q.trigger("route",O,R);e.history.trigger("route",Q,O,R)});return this},navigate:function(N,O){e.history.navigate(N,O);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=a.result(this,"routes");var N,O=a.keys(this.routes);while((N=O.pop())!=null){this.route(N,this.routes[N])}},_routeToRegExp:function(N){N=N.replace(h,"\\$&").replace(v,"(?:$1)?").replace(t,function(O,P){return P?O:"([^/]+)"}).replace(F,"(.*?)");return new RegExp("^"+N+"$")},_extractParameters:function(P,N){var O=P.exec(N).slice(1);return a.map(O,function(Q){return Q?decodeURIComponent(Q):null})}});var m=e.History=function(){this.handlers=[];a.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var C=/^[#\/]|\s+$/g;var A=/^\/+|\/+$/g;var n=/msie [\w.]+/;var H=/\/$/;var w=/[?#].*$/;m.started=false;a.extend(m.prototype,i,{interval:50,getHash:function(O){var N=(O||this).location.href.match(/#(.*)$/);return N?N[1]:""},getFragment:function(O,N){if(O==null){if(this._hasPushState||!this._wantsHashChange||N){O=this.location.pathname;var P=this.root.replace(H,"");if(!O.indexOf(P)){O=O.slice(P.length)}}else{O=this.getHash()}}return O.replace(C,"")},start:function(S){if(m.started){throw new Error("Backbone.history has already been started")}m.started=true;this.options=a.extend({root:"/"},this.options,S);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var P=this.getFragment();var O=document.documentMode;var R=(n.exec(navigator.userAgent.toLowerCase())&&(!O||O<=7));this.root=("/"+this.root+"/").replace(A,"/");if(R&&this._wantsHashChange){this.iframe=e.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(P)}if(this._hasPushState){e.$(window).on("popstate",this.checkUrl)}else{if(this._wantsHashChange&&("onhashchange" in window)&&!R){e.$(window).on("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=P;var Q=this.location;var N=Q.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!N){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else{if(this._hasPushState&&N&&Q.hash){this.fragment=this.getHash().replace(C,"");this.history.replaceState({},document.title,this.root+this.fragment+Q.search)}}}if(!this.options.silent){return this.loadUrl()}},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);m.started=false},route:function(O,N){this.handlers.unshift({route:O,callback:N})},checkUrl:function(O){var N=this.getFragment();if(N===this.fragment&&this.iframe){N=this.getFragment(this.getHash(this.iframe))}if(N===this.fragment){return false}if(this.iframe){this.navigate(N)}this.loadUrl()},loadUrl:function(N){N=this.fragment=this.getFragment(N);return a.any(this.handlers,function(O){if(O.route.test(N)){O.callback(N);return true}})},navigate:function(N,O){if(!m.started){return false}if(!O||O===true){O={trigger:!!O}}var P=this.root+(N=this.getFragment(N||""));N=N.replace(w,"");if(this.fragment===N){return}this.fragment=N;if(N===""&&P!=="/"){P=P.slice(0,-1)}if(this._hasPushState){this.history[O.replace?"replaceState":"pushState"]({},document.title,P)}else{if(this._wantsHashChange){this._updateHash(this.location,N,O.replace);if(this.iframe&&(N!==this.getFragment(this.getHash(this.iframe)))){if(!O.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,N,O.replace)}}else{return this.location.assign(P)}}if(O.trigger){return this.loadUrl(N)}},_updateHash:function(P,N,Q){if(Q){var O=P.href.replace(/(javascript:|#).*$/,"");P.replace(O+"#"+N)}else{P.hash="#"+N}}});e.history=new m;var l=function(P,Q){var O=this;var N;if(P&&a.has(P,"constructor")){N=P.constructor}else{N=function(){return O.apply(this,arguments)}}a.extend(N,O,Q);var R=function(){this.constructor=N};R.prototype=O.prototype;N.prototype=new R;if(P){a.extend(N.prototype,P)}N.__super__=O.prototype;return N};r.extend=f.extend=B.extend=K.extend=m.extend=l;var J=function(){throw new Error('A "url" property or function must be specified')};var M=function(O,P){var N=P.error;P.error=function(Q){if(N){N(O,Q,P)}O.trigger("error",O,Q,P)}}}).call(this);